<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="common.etc">

    <!--  -->
    <select id="getWbsCdList" resultType="HashMap">
        <![CDATA[
        -- getWbsCdList
		SELECT MST.WBS_CD				AS wbsCd
			, MST.DEPT_NAME 			AS deptName
			, MST.SA_SABUN_NAME			AS saSabunName
			, MST.TSS_NM                AS tssNm
			, MST.TSS_STRT_DD           AS tssStrtDd
			, MST.TSS_FNH_DD            AS tssFnhDd
		FROM   IRIS_TSS_MGMT_MST MST
		WHERE 1=1
		AND   MST.PGS_STEP_CD = 'PG'
		]]>

			<if test=' ( fromDate != null and fromDate != "" )'>
				AND MST.PRJ_STR_DT <![CDATA[>=]]> #{fromDate}
			</if>
			<if test= '( toDate != null and toDate != "" )' >
				AND (CASE WHEN MST.PRJ_END_DT IS NULL OR MST.PRJ_END_DT = '' THEN '9999-12-31' ELSE MST.PRJ_END_DT END) <![CDATA[<=]]> #{toDate}
			</if>
		    <if test='(wbsCd != null and wbsCd != "")'>
				   AND MST.WBS_CD LIKE '%'+#{wbsCd}+'%'
		    </if>
		    <if test='(prjNm != null and prjNm != "")'>
				   AND MST.PRJ_NM LIKE '%'+#{prjNm}+'%'
		    </if>
		    <if test='(plEmpNo != null and plEmpNo != "")'>
				   AND MST.PL_EMP_NO = #{plEmpNo}
		    </if>
		    <if test='( saName != null and saName != "")'>
				   AND MST.SA_SABUN_NEW IN ( SELECT SA_SABUN_NEW FROM dbo.IRIS_SSO_USER EMP WHERE EMP.SA_NAME LIKE '%'+#{saName}+'%' )
		    </if>

		    <if test='(deptCd != null and deptCd != "")'>
				   AND MST.DEPT_CD = #{deptCd}
		    </if>
		    <if test='(roleCheck != null and roleCheck == "")'>
				   AND MST.DEPT_CODE = dbo.fn_getLeaderDeptCd(#{userDept})
		    </if>
		    <if test='(uperdeptName != null and uperdeptName != "")'>
				   AND UDET.DEPT_NAME LIKE '%'+#{uperdeptName}+'%'
		    </if>
		<![CDATA[
		ORDER BY TSS_STRT_DD DESC
        ]]>
    </select>

</mapper>