<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="common.ssoInfo">


	<delete id="deleteSsoUserIf">
		delete iris_sso_user_if	
	</delete>
	
	<delete id="deleteSsoDeptIf">
		delete iris_sso_dept_if	
	</delete>
	
	<!-- IF 사용자 테이블 조회 -->
	<select id="getSsoUser" resultType="hashmap">
		<![CDATA[
			-- getSsoUser 사용자 리스트 sp
			EXEC dbo.sp_ssoUserIf
		  ]]>
	</select>

	<!-- IF 부서테이블 조회  -->
	<select id="getSsoDept" resultType="hashmap">
		<![CDATA[
			-- getSsoDept 부서 리스트 sp
			EXEC dbo.sp_ssoDeptIf
		  ]]>
	</select>

	<!-- IF 팀명 조회  -->
	<select id="getSsoTeamInfo" resultType="hashmap">
		<![CDATA[
		-- getSsoTeamInfo IF 팀명 조회
		SELECT   sa_dept_name  		as saDeptName
				,sa_dept_new   		as saDeptNew
		FROM   IRIS_SSO_USER
		WHERE   SSO_EX_FLAG <> 'D'
		AND     SA_GSBER = '1100'
		]]>
	</select>

	<update id="updatePrjNm">
	-- updatePrjNm
	 UPDATE IRIS_PRJ_RSST_MST
	 	SET    PRJ_NM = #{saDeptName}
	 WHERE  DEPT_CD = #{saDeptNew}
	</update>


	<update id="saveUserInfo">
	-- saveUserInfo
	MERGE IRIS_SSO_USER_IF SU
            USING ( SELECT #{saSabunNew} AS sa_sabun_new ) AS Tab1
			ON  (SU.sa_sabun_new = Tab1.sa_sabun_new)	
            WHEN NOT MATCHED THEN
	INSERT 
         ( sa_sabun_new
		  ,sso_ex_flag
		  ,sa_user
		  ,sa_name
		  ,sa_ename
		  ,sa_cname
		  ,sa_dept_name
		  ,sa_dept_new
		  ,sa_upmu
		  ,sa_func
		  ,sa_func_name
		  ,sa_jobx_name
		  ,sa_jobx
		  ,sa_phone_area
		  ,sa_phone_o
		  ,sa_hand
		  ,sso_ex_auth
		  ,sa_mail
		  ,sa_gsber
		  ,sa_exps
		  ,sa_exps_name
		  ,sa_temp
		  ,sa_temp_date
		  ,frst_rgst_id
		  ,frst_rgst_dt
		  ,last_mdfy_id
		  ,last_mdfy_dt            
               ) 
            VALUES
                 ( #{saSabunNew}
				 , #{ssoExFlag}
				 , #{saUser}
				 , #{saName}
				 , #{saEname}
				 , #{saCname}
				 , #{saDeptName}
				 , #{saDeptNew}
				 , #{saUpmu}
				 , #{saFunc}
				 , #{saFuncName}
				 , #{saJobxName}
				 , #{saJobx}
				 , #{saPhoneArea}
				 , #{saPhoneo}
				 , #{saHand}
				 , #{ssoExAuth}
				 , #{saMail}
				 , #{saGsber}
				 , #{saExps}
				 , #{saExpsName}
				 , #{saTemp}
				 , #{saTempDate}
				 , 'batch'
				 , getdate()
				 , 'batch'
				 , getdate()
                 )
              WHEN MATCHED THEN
				UPDATE 
        		SET sso_ex_flag   = #{ssoExFlag}  
				   ,sa_user       = #{saUser}
				   ,sa_name       = #{saName}
				   ,sa_ename      = #{saEname}
			 	   ,sa_cname      = #{saCname}
				   ,sa_dept_name  = #{saDeptName}
				   ,sa_dept_new   = #{saDeptNew}
				   ,sa_upmu       = #{saUpmu}
				   ,sa_func       = #{saFunc}
				   ,sa_func_name  = #{saFuncName}
				   ,sa_jobx_name  = #{saJobxName}
				   ,sa_jobx       = #{saJobx}
				   ,sa_phone_area = #{saPhoneArea}
				   ,sa_phone_o    = #{saPhoneo}
				   ,sa_hand       = #{saHand}
				   ,sso_ex_auth   = #{ssoExAuth}
				   ,sa_mail       = #{saMail}
				   ,sa_gsber      = #{saGsber}
				   ,sa_exps       = #{saExps}
				   ,sa_exps_name  = #{saExpsName}	
				   ,sa_temp       = #{saTemp}
				   ,sa_temp_date  = #{saTempDate} 	 	  
				   ,last_mdfy_id  = 'batch'
				   ,last_mdfy_dt  = getdate();		
	
	</update>


	<update id="saveDeptInfo">
	-- saveDeptInfo
	MERGE IRIS_SSO_DEPT_IF SD
            USING ( SELECT #{deptCode} AS dept_code ) AS Tab1
			ON  (SD.dept_code = Tab1.dept_code)	
            WHEN NOT MATCHED THEN
            INSERT 
                 ( dept_code
				  ,ps_flag
				  ,dept_name
				  ,dept_ename
				  ,dept_cname
				  ,dept_level
				  ,dept_uper
				  ,uperdept_name
				  ,frst_rgst_id
				  ,frst_rgst_dt
				  ,last_mdfy_id
				  ,last_mdfy_dt            
                 ) 
            VALUES
                 ( #{deptCode}  
				 , #{psFlag}
				 , #{deptName }
				 , #{deptEname}
				 , #{deptCname}
				 , #{deptLevel}
				 , #{deptUper}
				 , #{uperdeptName}
				 , 'batch'
				 , getdate()
				 , 'batch'
				 , getdate()
                 )
              WHEN MATCHED THEN
				UPDATE 
                SET ps_flag    = #{psFlag}
				   ,dept_name  = #{deptName}
				   ,dept_ename = #{deptEname}
				   ,dept_cname = #{deptCname}
				   ,dept_level = #{deptLevel}
				   ,dept_uper  = #{deptUper}
				   ,uperdept_name = #{uperdeptName}				  
				   ,last_mdfy_id  = 'batch'
				   ,last_mdfy_dt  = getdate();
	
	</update>
</mapper>