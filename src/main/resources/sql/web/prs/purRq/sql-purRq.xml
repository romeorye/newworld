<?xml version="1.0" encoding="EUC-KR"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="prs.purRq">


	<select id="retrievePurRqList" resultType="hashmap">
		<![CDATA[
		/* retrievePurRqList  리스트 조회 */
			select a.S_CODE   as sCode
		         ,a.SAMPLE    as sample
				 ,a.M_CODE    as mCode
				 ,a.KNTTP     as knttp
				 ,a.USED_CODE as usedCode
				 ,a.PSTYP     as pstyp
				 ,a.IZWEK     as izwek
				 ,a.BIZ_CD    as bizCd
				 ,a.SAKTO     as sakto
		        ,(SELECT CODE_NM
		                    FROM PR_CODEMASTER_T x 
		                WHERE x.DEL_FLAG ='0'
						and       x.REGION_CD =a.region_cd 
						and       x.CODE = a.EKGRP
				 )	as ekgrpnm
				 ,EKGRP       as ekgrp
				 ,WERKS       as werks
				 ,ANLKL       as anlkl
				 ,SEQ_NUM     as seqNum
			from [dbo].[PR_HELPMASTER_T] a	 
			where   a.REGION_CD ='01' 
			]]>
			<if test="tabId == 'EM' ">
			and   a.KNTTP = 'P'
			and   a.PSTYP = ''
			and   a.USED_CODE ='S'
			and   a.IZWEK != '01'
			</if>
			<if test="tabId == 'EF' ">
			and   a.KNTTP = 'A'
			and   a.PSTYP = ''
			</if>
			<if test="tabId == 'CR' ">
			and   a.KNTTP = 'P'
			and   a.M_CODE ='투자'
			</if>
			<if test="tabId == 'OM' ">
			and   a.KNTTP = 'P'
			and   a.PSTYP = ''
			and   a.USED_CODE = 'O'
			</if>
	
	</select>

	<insert id="insertPurRqInfo" >
	insert into PR_PRSREQ_T
		(
		 SEQ_NUM
		 ,S_CODE,BANFN,BNFPO,KNTTP,PSTYP,TXZ01,MENGE,MEINS,EEIND,AFNAM,MATKL,WERKS,EKGRP,BEDNR
		,PREIS,WAERS,PEINH,SAKTO,POSID,PRS_FLAG,MAKER,VENDOR,CATALOGNO,POSITION,USED_CODE,BIZ_CD,ATTC_FIL_ID, BADATE
		) 
		values 
		(
		 (select max(SEQ_NUM)+1 from [dbo].[PR_PRSREQ_T] ) 
		,#{sCode},#{banfn},#{bnfpo},#{knttp},#{pstyp},#{txz01},#{menge},#{meins},#{eeind},#{afnam},#{matkl},#{werks},#{ekgrp},#{bednr}
        ,#{preis},#{waers},#{peinh},#{sakto},#{posid},#{prsFlag},#{maker},#{vendor},#{catalogno},#{position},#{usedCode},#{bizCd},#{attcFilId},getdate()
		)
	
	</insert>
	
	<select id="retrievePurRqInfo"  resultType="hashmap">
	/* retrievePurRqInfo  리스트 조회 */
	select   BANFN_PRS  as  banfnPrs   
			,BNFPO_PRS  as  bnfpoPrs   
			,SEQ_NUM    as  seqNum     
			,S_CODE     as  sCode      
			,BANFN      as  banfn       
			,BNFPO      as  bnfpo       
			,KNTTP      as  knttp       
			,PSTYP      as  pstyp       
			,TXZ01      as  txz01       
			,MENGE      as  menge       
			,MEINS      as  meins       
			,EEIND      as  eeind       
			,AFNAM      as  afnam       
			,MATKL      as  matkl       
			,WERKS      as  werks       
			,EKGRP      as  ekgrp       
			,BEDNR      as  bednr       
	        ,PREIS      as  preis       
	        ,WAERS      as  waers       
	      	,PEINH      as  peinh       
	      	,SAKTO      as  sakto       
	      	,ANLKL      as  anlkl       
	      	,TXT50      as  txt50       
	      	,KOSTL      as  kostl       
			,POSID      as  posid       
			,POST1      as  post1       
			,ITEM_TXT   as  itemTxt       
			,PRS_FLAG   as  prsFlag    
			,BIZ_CD     as  bizCd   
			,ATTC_FIL_ID as attcFilId   
		from [dbo].[PR_PRSREQ_T]
		where BANFN_PRS = cast(#{banfnPrs} as int) 
		
	</select>

</mapper>